{% extends "base.html" %}

{% block content %}
<h2 style="text-align:center; margin-bottom: 20px;">報告中心</h2>

{% if is_doctor %}
    <p style="text-align:center; color: #555;">目前為醫師模式，顯示所有病患的監測資料與歷史報告。</p>
{% else %}
    <p style="text-align:center; color: #555;">目前為病患模式，僅顯示個人監測報告。</p>
{% endif %}

<!-- 最新監測資料 -->
<div class="section">
    <h3>最新監測資料</h3>
    {% if latest_data %}
        {% if is_doctor %}
            {% for patient, data in latest_data.items() %}
                <div class="card doctor-card">
                    <h4>{{ patient }}</h4>
                    <p><strong>心跳:</strong> {{ data.metrics.heart_rate or 'N/A' }}</p>
                    <p><strong>血壓:</strong> {{ data.metrics.bp or 'N/A' }}</p>
                    <p><strong>體溫:</strong> {{ data.metrics.temp or 'N/A' }}</p>
                    <p><strong>最後紀錄:</strong> {{ data.last_log or 'N/A' }}</p>
                </div>
            {% endfor %}
        {% else %}
            <div class="card patient-card">
                <p><strong>心跳:</strong> {{ latest_data.metrics.heart_rate or 'N/A' }}</p>
                <p><strong>血壓:</strong> {{ latest_data.metrics.bp or 'N/A' }}</p>
                <p><strong>體溫:</strong> {{ latest_data.metrics.temp or 'N/A' }}</p>
                <p><strong>最後紀錄:</strong> {{ latest_data.last_log or 'N/A' }}</p>
            </div>
        {% endif %}
    {% else %}
        <p>尚無最新監測資料</p>
    {% endif %}
</div>

<!-- 歷史報告 -->
<div class="section">
    <h3>歷史報告</h3>
    {% if reports %}
        {% for patient, report_list in reports.items() %}
            <div class="card history-card">
                <h4>{{ patient }}</h4>
                {% for r in report_list %}
                    <p><strong>{{ r.timestamp }}:</strong> {{ r.summary }}</p>
                {% endfor %}
            </div>
        {% endfor %}
    {% else %}
        <p>尚無歷史報告</p>
    {% endif %}
</div>
{% endblock %}
