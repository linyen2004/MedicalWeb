{% extends "base.html" %}
{% block content %}
<h2 style="text-align:center; margin-bottom:20px;">居家醫療申請總覽</h2>

{% if requests %}
<div id="homecare-requests" style="max-width:800px; margin:0 auto;">
    {% for pname, req in requests.items() %}
    <div class="request-card">
        <div class="request-header" onclick="toggleRequest('{{ loop.index }}')">
            {{ pname }} 的申請紀錄
        </div>
        <div id="request{{ loop.index }}" class="request-details">
            <p><strong>申請時間：</strong>{{ req.requested_at }}</p>
            <p><strong>目前狀態：</strong>
                {% if req.status == "pending" %}
                    <span style="color:orange;">等待審核</span>
                {% elif req.status == "approved" %}
                    <span style="color:green;">已核准</span>
                {% elif req.status == "rejected" %}
                    <span style="color:red;">已駁回</span>
                {% else %}
                    {{ req.status }}
                {% endif %}
            </p>
            <p><strong>申請原因：</strong><br>{{ req.reason }}</p>

            <label for="note{{ loop.index }}"><strong>醫師評語：</strong></label>
            <textarea id="note{{ loop.index }}" rows="3" style="width:100%; margin-top:5px;"></textarea>
            <button onclick="saveNote('note{{ loop.index }}')" class="save-btn">儲存評語</button>
        </div>
    </div>
    {% endfor %}
</div>
{% else %}
<p style="text-align:center;">目前尚無任何居家醫療申請。</p>
{% endif %}

<style>
.request-card {
    border-radius: 8px;
    margin-bottom: 15px;
    overflow: hidden;
    box-shadow: 0 2px 6px rgba(0,0,0,0.1);
}
.request-header {
    padding: 12px;
    cursor: pointer;
    font-weight: bold;
    background-color: #3498db;
    color: #fff;
    transition: background 0.3s;
}
.request-header:hover {
    background-color: #2980b9;
}
.request-details {
    display: none;
    padding: 12px;
    background-color: #f9f9f9;
    border-top: 1px solid #ddd;
    line-height: 1.6;
}
.save-btn {
    margin-top: 6px;
    padding: 6px 12px;
    background-color: #2ecc71;
    color: white;
    border: none;
    border-radius: 4px;
    cursor: pointer;
}
.save-btn:hover {
    background-color: #27ae60;
}
</style>

<script>
function toggleRequest(id) {
    const section = document.getElementById("request" + id);
    section.style.display = (section.style.display === "block") ? "none" : "block";
}
function saveNote(noteId) {
    const content = document.getElementById(noteId).value;
    alert("評語已儲存：\n" + content);
    // TODO: 可使用 fetch() 傳回後端
}
</script>
{% endblock %}
